# Work Stream 3: SERIAL Column Types

## Overview
Implement auto-increment column types that automatically create and use sequences.

## Tests to Enable
**File:** `tests/postgresql/ddl/sequences.rs`
- `test_serial_column`
- `test_bigserial_column`
- `test_smallserial_column`
- `test_generated_always_as_identity`

## Column Types to Implement

### SERIAL
```sql
CREATE TABLE t (id SERIAL, name TEXT)
-- Equivalent to:
-- CREATE SEQUENCE t_id_seq;
-- CREATE TABLE t (id INTEGER NOT NULL DEFAULT NEXTVAL('t_id_seq'), name TEXT);
-- ALTER SEQUENCE t_id_seq OWNED BY t.id;
```

### BIGSERIAL
- Same as SERIAL but uses BIGINT (64-bit)

### SMALLSERIAL
- Same as SERIAL but uses SMALLINT (16-bit)

### GENERATED AS IDENTITY (SQL Standard)
```sql
-- Always use sequence, cannot specify explicit value
CREATE TABLE t (id INTEGER GENERATED ALWAYS AS IDENTITY, name TEXT)

-- Use sequence by default, can override with explicit value
CREATE TABLE t (id INTEGER GENERATED BY DEFAULT AS IDENTITY, name TEXT)

-- With sequence options
CREATE TABLE t (
    id INTEGER GENERATED ALWAYS AS IDENTITY (START WITH 100 INCREMENT BY 10),
    name TEXT
)
```

## Key Files to Modify

### Parser
- `crates/parser/src/` - recognize SERIAL, BIGSERIAL, SMALLSERIAL as types
- Parse GENERATED ... AS IDENTITY clause
- Transform SERIAL into INTEGER + sequence creation

### DDL Execution (CREATE TABLE)
- `crates/executor/src/query_executor/execution/ddl/table.rs`
- When SERIAL column detected:
  1. Create implicit sequence named `{table}_{column}_seq`
  2. Set column type to INTEGER/BIGINT/SMALLINT
  3. Set column default to `NEXTVAL('{table}_{column}_seq')`
  4. Set column NOT NULL
  5. Set sequence OWNED BY this column

### DML Execution (INSERT)
- `crates/executor/src/query_executor/execution/dml/insert.rs`
- For GENERATED ALWAYS: reject explicit values (unless OVERRIDING SYSTEM VALUE)
- For GENERATED BY DEFAULT: use sequence only when value not provided
- Evaluate DEFAULT expressions that call NEXTVAL

## Implementation Notes

1. SERIAL is syntactic sugar, not a real type
2. Implicit sequence naming: `{table}_{column}_seq`
3. GENERATED ALWAYS vs BY DEFAULT:
   - ALWAYS: error if user provides value (unless OVERRIDING SYSTEM VALUE)
   - BY DEFAULT: use provided value, sequence only when DEFAULT/omitted
4. DROP TABLE should CASCADE to owned sequence
5. Handle INSERT with explicit column list vs full row

## Type Mapping
| Type | Underlying Type | Range |
|------|-----------------|-------|
| SMALLSERIAL | SMALLINT | 1 to 32,767 |
| SERIAL | INTEGER | 1 to 2,147,483,647 |
| BIGSERIAL | BIGINT | 1 to 9,223,372,036,854,775,807 |

## Test Commands
```bash
cargo test --test postgresql test_serial_column
cargo test --test postgresql test_bigserial_column
cargo test --test postgresql test_smallserial_column
cargo test --test postgresql test_generated_always_as_identity
cargo test --test postgresql test_generated_by_default_as_identity
```

## Dependencies
- Work Stream 1 (Sequence Functions) - NEXTVAL implementation
- Work Stream 2 (CREATE SEQUENCE) - sequence creation

Can stub sequence calls initially and integrate once Streams 1 & 2 are complete.

## Coordination
- Coordinate with Stream 2 on sequence naming conventions
- Coordinate with Stream 2 on OWNED BY implementation for CASCADE behavior
